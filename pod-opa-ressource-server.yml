apiVersion: v1
kind: Pod
metadata:
  name: two-containers
spec:

  restartPolicy: Never

  volumes:
  - name: shared-data
    emptyDir: {}

  containers:

  - name: ressource-server
    image: oauth2-opa
    ports:
    - name: http
      containerPort: 8080    

  - name: opa
    image: openpolicyagent/opa:latest
    ports:
    - name: http
      containerPort: 8181
    args:
    - "run"
    - "--ignore=.*"  # exclude hidden dirs created by Kubernetes
    - "--server"
    - "/policies"
    volumeMounts:
    - readOnly: true
      mountPath: /policies
      name: example-policy
  volumes:
  - name: example-policy
    configMap:
      name: example-policy
